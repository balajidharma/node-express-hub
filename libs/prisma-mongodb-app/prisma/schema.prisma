generator client {
  provider = "prisma-client-js"
  output   = "../../../node_modules/@prisma/client/mongodb-app"
}

datasource db {
  provider = "mongodb"
  url      = env("MONGODB_APP_DATABASE_URL")
}

model User {
  id           String         @id @default(auto()) @map("_id") @db.ObjectId
  name         String?
  email        String         @unique
  username     String?        @unique
  password     String
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
  RefreshToken RefreshToken[]
  BlockedToken BlockedToken[]
}

model RefreshToken {
  id         String    @id @default(auto()) @map("_id") @db.ObjectId
  token      String    @unique
  userId     String    @db.ObjectId
  deviceId   String?
  deviceName String?
  deviceType String?
  location   String?
  userAgent  String?
  ipAddress  String?
  usedAt     DateTime  @default(now())
  createdAt  DateTime  @default(now())
  expiresAt  DateTime?
  user       User      @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model BlockedToken {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  userId        String   @db.ObjectId
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  token         String   @unique // Could be access token or refresh token
  blockedReason String?
  blockedAt     DateTime @default(now())
}
